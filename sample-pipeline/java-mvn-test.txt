pipeline {
    agent {
        docker {
            image 'maven:3.9.9-eclipse-temurin-21' // Java + Maven Image
            args '-v $HOME/.m2:/root/.m2'
        }
    }

    environment {
        GIT_SSL_NO_VERIFY = 'true'  // SSL verify ignore
    }

    stages {
    
        stage('Clone') {
            steps {
                withCredentials([
                    usernamePassword(
                        credentialsId: 'gitlab-user-jks-pw', 
                        usernameVariable: 'USER', 
                        passwordVariable: 'TOKEN'
                    )
                ]) {
                    sh '''
                        echo "=== [1/2] Git Clone ==="
                        git config --global http.sslVerify false
                        rm -rf java-project       # ì´ì „ ë¹Œë“œ ì”ì—¬ë¬¼ ì‚­ì œ
                        git clone https://${USER}:${TOKEN}@192.168.0.12:7743/JKS/java-project.git
                    '''
                }
            }
        }

        stage('Java Build and RUN') {
            steps {
                dir('java-project') {  // Cloneëœ í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
                    script {
                        echo "=== [2/2] Maven Build ==="
                        sh '''
                            # Maven Build and RUN
                            mvn clean 
                            mvn compile
                            mvn test
                            mvn exec:java
                            mvn clean
                        '''
                    }
                }
            }
        }
    }

    post {
        success {
            echo "âœ… ì „ì²´ Pipeline ì„±ê³µ"
        }
        failure {
            echo "âŒ Pipeline ì‹¤íŒ¨"
        }
        always {
            echo "ğŸ”„ Pipeline ì¢…ë£Œ"
        }
    }
}